(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{366:function(t,r,_){t.exports=_.p+"assets/img/open_monitor.6c0dcd84.png"},367:function(t,r,_){t.exports=_.p+"assets/img/choose_host_metric_monitor.9424e4a9.png"},368:function(t,r,_){t.exports=_.p+"assets/img/add_host_metric_monitor.1c0f59ae.png"},369:function(t,r,_){t.exports=_.p+"assets/img/alert.c6617b65.png"},399:function(t,r,_){"use strict";_.r(r);var e=_(45),v=Object(e.a)({},(function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"監視ルールを追加する"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#監視ルールを追加する"}},[t._v("#")]),t._v(" 監視ルールを追加する")]),t._v(" "),e("p",[t._v("このハンズオンでは監視ルールを設定して擬似的な障害を起こし、Mackerelでの障害対応を体験します。")]),t._v(" "),e("h2",{attrs:{id:"ホストのメトリックを監視する"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ホストのメトリックを監視する"}},[t._v("#")]),t._v(" ホストのメトリックを監視する")]),t._v(" "),e("p",[t._v("以下の手順に沿って、CPU使用率を監視するルールを設定してみましょう。")]),t._v(" "),e("p",[t._v("まずは左サイドメニュー"),e("a",{attrs:{href:"https://mackerel.io/my/monitors",target:"_blank",rel:"noopener noreferrer"}},[t._v("Monitors"),e("OutboundLink")],1),t._v("を開き、右上の"),e("code",[t._v("監視ルールを追加")]),t._v("をクリックします。\n"),e("img",{attrs:{src:_(366),alt:""}})]),t._v(" "),e("p",[e("code",[t._v("新規監視ルールを作成")]),t._v("のメニューの中から"),e("code",[t._v("ホストメトリック監視")]),t._v("を選択します。\n"),e("img",{attrs:{src:_(367),alt:""}})]),t._v(" "),e("br"),t._v(" "),e("p",[t._v("各項目に以下の表の内容を設定して監視ルールを作成しましょう。")]),t._v(" "),e("p",[e("img",{attrs:{src:_(368),alt:""}})]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("項目")]),t._v(" "),e("th",[t._v("設定値")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("メトリック")]),t._v(" "),e("td",[t._v("CPU %")])]),t._v(" "),e("tr",[e("td",[t._v("閾値（Warning条件）")]),t._v(" "),e("td",[t._v("70")])]),t._v(" "),e("tr",[e("td",[t._v("閾値（Critical条件）")]),t._v(" "),e("td",[t._v("90")])]),t._v(" "),e("tr",[e("td",[t._v("平均値監視")]),t._v(" "),e("td",[t._v("3点の平均値を監視")])]),t._v(" "),e("tr",[e("td",[t._v("最大試行回数")]),t._v(" "),e("td",[t._v("1回")])]),t._v(" "),e("tr",[e("td",[t._v("絞込条件")]),t._v(" "),e("td",[t._v("変更しない")])]),t._v(" "),e("tr",[e("td",[t._v("監視ルール名")]),t._v(" "),e("td",[t._v("任意")])]),t._v(" "),e("tr",[e("td",[t._v("監視ルールのメモ")]),t._v(" "),e("td",[t._v("任意")])]),t._v(" "),e("tr",[e("td",[t._v("通知の再送間隔")]),t._v(" "),e("td",[t._v("チェックしない")])])])]),t._v(" "),e("p",[e("a",{attrs:{href:"https://mackerel.io/my/monitors",target:"_blank",rel:"noopener noreferrer"}},[t._v("Monitors"),e("OutboundLink")],1),t._v("にホストメトリック監視のルールが追加されたことを確認します。")]),t._v(" "),e("h2",{attrs:{id:"監視対象サーバー上で障害を起こす"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#監視対象サーバー上で障害を起こす"}},[t._v("#")]),t._v(" 監視対象サーバー上で障害を起こす")]),t._v(" "),e("p",[t._v("続いて、監視対象サーバーにログインしたあとに、以下のコマンドを実行し意図的に CPU に負荷を掛けてみます。")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("yes")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /dev/null\n")])])]),e("ul",[e("li",[e("code",[t._v("yes")]),t._v("コマンドは標準出力に"),e("code",[t._v("y")]),t._v("を延々と出力し、その出力をただ捨てるだけのコマンドです。")])]),t._v(" "),e("p",[t._v("実行したら、少し時間をおいて変化を見てみましょう。")]),t._v(" "),e("h2",{attrs:{id:"webコンソールでアラートを確認する"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#webコンソールでアラートを確認する"}},[t._v("#")]),t._v(" Webコンソールでアラートを確認する")]),t._v(" "),e("ul",[e("li",[t._v("左サイドメニュー"),e("a",{attrs:{href:"https://mackerel.io/my/hosts",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hosts"),e("OutboundLink")],1),t._v("から詳細画面を表示して、CPU使用率のグラフを確認しましょう。")]),t._v(" "),e("li",[t._v("アラートが発報されたら左サイドメニュー"),e("a",{attrs:{href:"https://mackerel.io/my/alerts",target:"_blank",rel:"noopener noreferrer"}},[t._v("Alerts"),e("OutboundLink")],1),t._v("を確認し、発報されたアラート詳細画面を確認してみましょう")]),t._v(" "),e("li",[t._v("通知されたアラートメールも確認してみましょう")])]),t._v(" "),e("p",[t._v("ここまでで、Mackerelではサーバーのグラフがどのように表示され、障害が発生した時の対応をどのように実施するかイメージいただけたでしょうか？")]),t._v(" "),e("p",[t._v("それでは障害を解消してみましょう。ターミナル上で"),e("code",[t._v("Ctrl+C")]),t._v("を入力して"),e("code",[t._v("yes")]),t._v("コマンドを中断してCPUのグラフとアラートにどのような変化が起こるか見てみましょう。")]),t._v(" "),e("p",[e("img",{attrs:{src:_(369),alt:""}})]),t._v(" "),e("p",[t._v("アラートが発報してからのステータスの遷移が記録され、アラートが自動的にクローズされたことを確認いただけたかと思います。\nこの様にMackerelでは障害が解消したことを検知して、自動的にアラートをクローズする仕組みとなっています。")]),t._v(" "),e("p",[t._v("次のハンズオンでは公式プラグインを導入して、監視を拡張してみましょう。")])])}),[],!1,null,null,null);r.default=v.exports}}]);