(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{384:function(t,e,r){t.exports=r.p+"assets/img/twilio_console.d82d5327.png"},385:function(t,e,r){t.exports=r.p+"assets/img/channel_twilio.bfa2cd63.png"},386:function(t,e,r){t.exports=r.p+"assets/img/notification_target_twilio.e27b6341.png"},387:function(t,e,r){t.exports=r.p+"assets/img/alert.708b1cef.png"},409:function(t,e,r){"use strict";r.r(e);var _=r(45),o=Object(_.a)({},(function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"twilioと連携して架電通知をする"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#twilioと連携して架電通知をする"}},[t._v("#")]),t._v(" Twilioと連携して架電通知をする")]),t._v(" "),_("p",[t._v("さきほど作成したアカウントを利用して、アラート通知をメール通知ではなく電話による架電通知する設定を行ってみましょう。")]),t._v(" "),_("h2",{attrs:{id:"twilio-apiを利用するための資格情報を確認する"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#twilio-apiを利用するための資格情報を確認する"}},[t._v("#")]),t._v(" Twilio APIを利用するための資格情報を確認する")]),t._v(" "),_("p",[t._v("TwilioのAPIを利用する場合は"),_("code",[t._v("ACCOUNT SID")]),t._v("、"),_("code",[t._v("AUTH TOKEN")]),t._v("と呼ばれる資格情報が必要になります。")]),t._v(" "),_("p",[_("a",{attrs:{href:"https://jp.twilio.com/console/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Twilioコンソール"),_("OutboundLink")],1),t._v("を開き、"),_("code",[t._v("アカウント SID")]),t._v("、"),_("code",[t._v("Auth Token")]),t._v("をそれぞれ控えておきます。")]),t._v(" "),_("p",[_("img",{attrs:{src:r(384),alt:"コンソール"}})]),t._v(" "),_("h3",{attrs:{id:"auth-token-について"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#auth-token-について"}},[t._v("#")]),t._v(" "),_("strong",[t._v("Auth Token")]),t._v(" について")]),t._v(" "),_("p",[_("code",[t._v("Auth Token")]),t._v("はパスワードに値する非常に "),_("strong",[t._v("重要な情報")]),t._v(" なので、"),_("code",[t._v("アカウント SID")]),t._v("と共に外部に流出しないように取り扱いについては十分注意してください。")]),t._v(" "),_("h2",{attrs:{id:"twilioの通知チャンネルを作成する"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#twilioの通知チャンネルを作成する"}},[t._v("#")]),t._v(" Twilioの通知チャンネルを作成する")]),t._v(" "),_("p",[t._v("左サイドメニューから"),_("a",{attrs:{href:"https://mackerel.io/my/channels",target:"_blank",rel:"noopener noreferrer"}},[t._v("Channels"),_("OutboundLink")],1),t._v("を開いて、右上にある"),_("code",[t._v("通知グループ／通知チャンネルを追加")]),t._v("からTwilioの通知チャンネルを追加します。")]),t._v(" "),_("p",[_("img",{attrs:{src:r(385),alt:""}})]),t._v(" "),_("p",[t._v("Twilioのハンズオンで作成したアカウントで払い出された"),_("code",[t._v("ACCOUNT SID")]),t._v("と"),_("code",[t._v("AUTH TOKEN")]),t._v("、"),_("code",[t._v("電話番号")]),t._v("などを入力して保存してください。")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("項目")]),t._v(" "),_("th",[t._v("設定値")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("通知チャンネル名")]),t._v(" "),_("td",[_("code",[t._v("架電通知")]),t._v("（任意）")])]),t._v(" "),_("tr",[_("td",[t._v("AccountSid")]),t._v(" "),_("td",[_("a",{attrs:{href:"https://jp.twilio.com/console",target:"_blank",rel:"noopener noreferrer"}},[t._v("Twilioのコンソール"),_("OutboundLink")],1),t._v("から"),_("code",[t._v("ACCOUNT SID")]),t._v("を転記")])]),t._v(" "),_("tr",[_("td",[t._v("AuthToken")]),t._v(" "),_("td",[_("a",{attrs:{href:"https://jp.twilio.com/console",target:"_blank",rel:"noopener noreferrer"}},[t._v("Twilioのコンソール"),_("OutboundLink")],1),t._v("から"),_("code",[t._v("AUTH TOKEN")]),t._v("を転記")])]),t._v(" "),_("tr",[_("td",[t._v("From")]),t._v(" "),_("td",[_("a",{attrs:{href:"https://jp.twilio.com/console/phone-numbers/incoming",target:"_blank",rel:"noopener noreferrer"}},[t._v("Twilioのコンソール"),_("OutboundLink")],1),t._v("から確保した電話番号を"),_("a",{attrs:{href:"https://www.twilio.com/docs/glossary/what-e164",target:"_blank",rel:"noopener noreferrer"}},[t._v("E.164形式"),_("OutboundLink")],1),t._v("で転記")])]),t._v(" "),_("tr",[_("td",[t._v("To")]),t._v(" "),_("td",[t._v("着信可能な電話番号を"),_("a",{attrs:{href:"https://www.twilio.com/docs/glossary/what-e164",target:"_blank",rel:"noopener noreferrer"}},[t._v("E.164形式"),_("OutboundLink")],1),t._v("で入力（Twilioアカウントがトライアル版の場合は"),_("a",{attrs:{href:"https://jp.twilio.com/console/phone-numbers/verified",target:"_blank",rel:"noopener noreferrer"}},[t._v("検証済み電話番号"),_("OutboundLink")],1),t._v("に登録されている番号を指定）")])]),t._v(" "),_("tr",[_("td",[t._v("Notification Type")]),t._v(" "),_("td")]),t._v(" "),_("tr",[_("td",[t._v("Message")]),t._v(" "),_("td",[_("code",[t._v("アラートを確認してください")]),t._v("（発話させる内容を入力）")])]),t._v(" "),_("tr",[_("td",[t._v("Language")]),t._v(" "),_("td",[_("code",[t._v("ja-JP")])])]),t._v(" "),_("tr",[_("td",[t._v("Notification Level")]),t._v(" "),_("td",[_("code",[t._v("Warning & Critical")])])]),t._v(" "),_("tr",[_("td",[t._v("Status Callback URL(Optional)")]),t._v(" "),_("td",[t._v("（未設定）")])]),t._v(" "),_("tr",[_("td",[t._v("通知するイベント")]),t._v(" "),_("td",[t._v("（変更しない）")])]),t._v(" "),_("tr",[_("td",[t._v("デフォルト通知グループに追加する")]),t._v(" "),_("td",[t._v("チェックを外す")])])])]),t._v(" "),_("p",[t._v("通知チャンネルにTwilioのチャンネルが追加されていることを確認してみましょう。")]),t._v(" "),_("h2",{attrs:{id:"通知グループに紐付ける"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#通知グループに紐付ける"}},[t._v("#")]),t._v(" 通知グループに紐付ける")]),t._v(" "),_("p",[t._v("次にハンズオンで作成した通知グループ（手順通りだと"),_("code",[t._v("HTTPプロセスの監視")]),t._v("のグループ）の通知先のチャンネルを"),_("code",[t._v("Email Broadcast")]),t._v("から追加したTwilioのチャンネルに変更します。")]),t._v(" "),_("p",[_("img",{attrs:{src:r(386),alt:""}})]),t._v(" "),_("p",[t._v("わかりやすくするために"),_("code",[t._v("Email Broadcast")]),t._v("のチャンネルはオフにしておきましょう。")]),t._v(" "),_("h2",{attrs:{id:"障害を起こして通知の確認をする"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#障害を起こして通知の確認をする"}},[t._v("#")]),t._v(" 障害を起こして通知の確認をする")]),t._v(" "),_("p",[t._v("それでは障害を起こして通知を確認してみましょう。")]),t._v(" "),_("p",[t._v("前回と同様にサーバー上でhttpdプロセスを停止してアラートが発報されることを確認しましょう。")]),t._v(" "),_("div",{staticClass:"language-shell extra-class"},[_("pre",{pre:!0,attrs:{class:"language-shell"}},[_("code",[_("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl stop httpd\n")])])]),_("p",[t._v("指定した電話番号宛に架電され、指定したメッセージによる通知が行われたでしょうか？")]),t._v(" "),_("p",[_("a",{attrs:{href:"https://mackerel.io/my/alerts",target:"_blank",rel:"noopener noreferrer"}},[t._v("Alerts"),_("OutboundLink")],1),t._v("を確認すると、通知先が作成したTwilioのチャンネルにのみ通知されていることが確認できるかと思います。")]),t._v(" "),_("p",[_("img",{attrs:{src:r(387),alt:""}})]),t._v(" "),_("h2",{attrs:{id:"音声ではなく、smsでアラートを受け取るには"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#音声ではなく、smsでアラートを受け取るには"}},[t._v("#")]),t._v(" 音声ではなく、SMSでアラートを受け取るには")]),t._v(" "),_("p",[t._v("音声通話ではなくSMSでアラートを受け取る場合は\n次のように設定項目を変更します。")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("項目")]),t._v(" "),_("th",[t._v("設定値")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("Notification Type")]),t._v(" "),_("td",[t._v("SMS")])])])]),t._v(" "),_("p",[t._v("この場合は固定のメッセージが送信されます。")])])}),[],!1,null,null,null);e.default=o.exports}}]);