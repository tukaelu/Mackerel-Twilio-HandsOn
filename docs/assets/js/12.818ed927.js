(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{375:function(a,e,s){a.exports=s.p+"assets/img/custom_metric.73207767.png"},390:function(a,e,s){"use strict";s.r(e);var t=s(45),n=Object(t.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"公式メトリックプラグインを導入する"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#公式メトリックプラグインを導入する"}},[a._v("#")]),a._v(" 公式メトリックプラグインを導入する")]),a._v(" "),t("p",[a._v("監視対象ホストに公式メトリックプラグインをインストールしてOS、ミドルウェアの監視をしてみましょう。")]),a._v(" "),t("h2",{attrs:{id:"公式プラグインをインストールする"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#公式プラグインをインストールする"}},[a._v("#")]),a._v(" 公式プラグインをインストールする")]),a._v(" "),t("p",[a._v("監視対象サーバーで以下のコマンドを実行し、公式プラグインをインストールします。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -y mackerel-agent-plugins\n")])])]),t("p",[a._v("完了したら、インストールされたプラグインを見てましょう。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" -l /usr/bin/mackerel-plugin-*\n")])])]),t("p",[a._v("50を超えるプラグインがインストールされていることを確認していただけるかと思います！")]),a._v(" "),t("p",[a._v("Mackerelの公式プラグイン集は以下のGitHubリポジトリで公開されていて、OSS（オープンソースソフトウェア）なので、いつでも誰でも実装を確認できますし、修正や機能追加なども可能です。")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/mackerelio/mackerel-agent-plugins",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/mackerelio/mackerel-agent-plugins"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("それでは数あるプラグインのうちLinuxに関するメトリック監視を拡張する"),t("code",[a._v("mackerel-plugin-linux")]),a._v("をセットアップしてみましょう。")]),a._v(" "),t("h2",{attrs:{id:"osに関するメトリックを拡張してみる"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#osに関するメトリックを拡張してみる"}},[a._v("#")]),a._v(" OSに関するメトリックを拡張してみる")]),a._v(" "),t("p",[a._v("公式プラグインパッケージに含まれている mackerel-plugin-linux プラグインを使用して、Linux OSに関するメトリックを拡張してみます。")]),a._v(" "),t("p",[a._v("mackerel-agent に mackerel-plugin-linux プラグインを導入するには設定ファイル "),t("code",[a._v("/etc/mackerel-agent/mackerel-agent.conf")]),a._v(" をviなどで開いて以下の2行を追記します。")]),a._v(" "),t("div",{staticClass:"language-toml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[a._v("plugin.metrics.linux")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[a._v("command")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mackerel-plugin-linux"')]),a._v("\n")])])]),t("p",[a._v("以下のコマンドをターミナルで実行することでも追記できます。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("SCRIPT\ncat >>/etc/mackerel-agent/mackerel-agent.conf <<'EOF';\n[plugin.metrics.linux]\ncommand = \"mackerel-plugin-linux\"\nEOF\nSCRIPT")]),a._v("\n")])])]),t("p",[a._v("特にエラーなどが発生せず、再びコマンドが入力できる状態になっていれば成功です。（完了メッセージも表示されません）")]),a._v(" "),t("p",[a._v("mackerel-agent.conf を変更した際に有効なシンタックスチェック機能が mackerel-agent には備わっています。次のコマンドを実行してみましょう。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("mackerel-agent configtest\n")])])]),t("p",[a._v("次のような結果が出力されれば記載ミスなどがないことを確認できます。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("/etc/mackerel-agent/mackerel-agent.conf Syntax OK\n")])])]),t("p",[a._v("問題なければ、以下のコマンドにより mackerel-agent を再起動します。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl restart mackerel-agent\n")])])]),t("p",[a._v("コマンド実行後、"),t("code",[a._v("[ OK ]")]),a._v("と表示されていれば起動成功です。")]),a._v(" "),t("h3",{attrs:{id:"プラグインを手動で実行してみる"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#プラグインを手動で実行してみる"}},[a._v("#")]),a._v(" プラグインを手動で実行してみる")]),a._v(" "),t("p",[a._v("本来はエージェントに組み込み、エージェントが実行するプラグインですが、人の手で実行することも可能です。\n以下のコマンドにより実行してみて、どのような結果が得られるか確認してみましょう。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" mackerel-plugin-linux\n")])])]),t("p",[a._v("以下のような結果が表示されればプラグインが正常に実行されています。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("linux.users.users\t"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.000000")]),a._v("\t"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1620797938")]),a._v("\nlinux.swap.pswpin\t"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.000000")]),a._v("\t"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1620797938")]),a._v("\nlinux.swap.pswpout\t"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.000000")]),a._v("\t"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1620797938")]),a._v("\nlinux.ss.ESTAB\t"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("89.000000")]),a._v("\t"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1620797938")]),a._v("\nlinux.ss.UNCONN\t"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("51.000000")]),a._v("\t"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1620797938")]),a._v("\nlinux.ss.LISTEN\t"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("42.000000")]),a._v("\t"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1620797938")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v("\n")])])]),t("p",[t("code",[a._v("mackerel-plugin-*")]),a._v(" のようなメトリックの監視を拡張するプラグインは規定のフォーマットで標準出力する仕様のため、以下の仕様に沿って実装されサーバー上で実行が可能であれば開発言語は問わず実装することが出来ます。")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://mackerel.io/ja/docs/entry/advanced/custom-metrics#post-metric",target:"_blank",rel:"noopener noreferrer"}},[a._v("ホストのカスタムメトリックを投稿する - Mackerel ヘルプ"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("それでは設定したプラグインのメトリックがホストに反映されているか確認してみましょう。")]),a._v(" "),t("h3",{attrs:{id:"プラグインのメトリックを確認する"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#プラグインのメトリックを確認する"}},[a._v("#")]),a._v(" プラグインのメトリックを確認する")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://mackerel.io/my/hosts",target:"_blank",rel:"noopener noreferrer"}},[a._v("Hosts"),t("OutboundLink")],1),a._v("から設定したホストの詳細画面を開いて確認してみましょう。")]),a._v(" "),t("p",[t("img",{attrs:{src:s(375),alt:""}})]),a._v(" "),t("p",[a._v("プラグインが取得したメトリックはカスタムメトリックとしてホストに投稿されている事が確認できました。")]),a._v(" "),t("p",[a._v("Mackerelでは mackerel-agent が収集するメトリックはシステムメトリック、プラグインが収集するメトリックはカスタムメトリックとして分類されます。")]),a._v(" "),t("p",[a._v("次のハンズオンではサーバーの状態を確認するチェック監視プラグインを導入してみます。")])])}),[],!1,null,null,null);e.default=n.exports}}]);