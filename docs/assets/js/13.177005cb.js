(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{359:function(a,e,t){a.exports=t.p+"assets/img/image01.77b0ae19.png"},360:function(a,e,t){a.exports=t.p+"assets/img/hosts.c683d58b.png"},402:function(a,e,t){"use strict";t.r(e);var s=t(45),r=Object(s.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"エージェントをインストールする"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#エージェントをインストールする"}},[a._v("#")]),a._v(" エージェントをインストールする")]),a._v(" "),s("p",[a._v("このハンズオンでは監視対象となるサーバーに mackerel-agent をインストールして監視を始めます。")]),a._v(" "),s("h2",{attrs:{id:"エージェントをインストール"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#エージェントをインストール"}},[a._v("#")]),a._v(" エージェントをインストール")]),a._v(" "),s("p",[a._v("Webコンソールの左サイドメニューの下部にある"),s("a",{attrs:{href:"https://mackerel.io/my/instruction-agent",target:"_blank",rel:"noopener noreferrer"}},[a._v("新規ホストの登録"),s("OutboundLink")],1),a._v("にアクセスして、監視対象OSのインストールスクリプトをコピーします。")]),a._v(" "),s("p",[s("img",{attrs:{src:t(359),alt:""}})]),a._v(" "),s("p",[a._v("Amazon Linux2の場合は以下のような内容をコピーします。（貸与しているハンズオンサーバーは"),s("code",[a._v("Amazon Linux2")]),a._v("となります）")]),a._v(" "),s("ul",[s("li",[a._v("コマンドの右端にあるクリップボードアイコンからコピーできます。")]),a._v(" "),s("li",[s("code",[a._v("<YOUR API KEY>")]),a._v("は環境によって異なります。")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -fsSL https://mackerel.io/file/script/amznlinux/setup-all-yum-v2.sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MACKEREL_APIKEY")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'<YOUR API KEY>'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v("\n")])])]),s("p",[a._v("コピーしたインストールコマンドをターミナル上で実行します。")]),a._v(" "),s("p",[a._v("以下のように表示されればインストールが成功して監視が始まっています！")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),a._v("\n*************************************\n\n     Done"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" Welcome to Mackerel"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v("\n\n*************************************\n")])])]),s("h2",{attrs:{id:"登録されたホストを見てみる"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#登録されたホストを見てみる"}},[a._v("#")]),a._v(" 登録されたホストを見てみる")]),a._v(" "),s("p",[a._v("インストールが完了したら"),s("a",{attrs:{href:"https://mackerel.io/my/hosts",target:"_blank",rel:"noopener noreferrer"}},[a._v("Hosts"),s("OutboundLink")],1),a._v("にアクセスして、mackerel-agentをインストールしたホストが登録されているか確認してみましょう。（反映までに1〜2分かかる場合があります）")]),a._v(" "),s("p",[s("img",{attrs:{src:t(360),alt:""}})]),a._v(" "),s("p",[a._v("ホスト名をクリックしてホスト詳細画面にアクセスし、 mackerel-agent が収集する情報にどのようなものがあるかメトリック仕様と照らし合わせて確認してみてください。")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://mackerel.io/ja/docs/entry/spec/metrics",target:"_blank",rel:"noopener noreferrer"}},[a._v("メトリック仕様 - Mackerel ヘルプ"),s("OutboundLink")],1)])]),a._v(" "),s("h2",{attrs:{id:"インストールが上手く行かない場合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#インストールが上手く行かない場合"}},[a._v("#")]),a._v(" インストールが上手く行かない場合")]),a._v(" "),s("p",[a._v("インストールが正常に行なえない場合、以下などに該当していないかご確認ください。")]),a._v(" "),s("h3",{attrs:{id:"異なるosのインストールコマンドを実行してしまった場合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#異なるosのインストールコマンドを実行してしまった場合"}},[a._v("#")]),a._v(" 異なるOSのインストールコマンドを実行してしまった場合")]),a._v(" "),s("p",[a._v("Amazon Linux2 の環境に Amazon Linux のインストールコマンドを実行してしまったなどの場合は、mackerel-agent のアンインストールとリポジトリの削除を行い、改めて正しいインストールスクリプトを実行する必要があります。")]),a._v(" "),s("p",[a._v("アンインストールの一連の手順は以下を実行してください。")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum remove -y mackerel-agent mackerel-agent-plugins mackerel-check-plugins mkr\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" /etc/yum.repos.d/mackerel.repo\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum remove mackerel-repo.noarch\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum clean all\n")])])]),s("h3",{attrs:{id:"インストール後にmackerel-agentが起動しない場合"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#インストール後にmackerel-agentが起動しない場合"}},[a._v("#")]),a._v(" インストール後にmackerel-agentが起動しない場合")]),a._v(" "),s("p",[a._v("インストールしたホストからインターネットへの通信が行えていないなどが考えられます。")]),a._v(" "),s("p",[a._v("mackerel-agentのログを確認して、どのようなエラーが発生しているかなど確認をしてください。")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" journalctl -u mackerel-agent.service\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);